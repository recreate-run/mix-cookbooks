# Portfolio Analyzer

AI-powered portfolio analysis with CSV upload, real-time streaming, and visualizations using Mix SDK and TanStack Start.

## Features

- **CSV File Upload**: Drag-and-drop interface for uploading portfolio data
- **Real-time AI Analysis**: Streaming AI responses with live updates
- **Data Visualization**: Interactive charts and graphs generated by AI
- **Mix SDK Integration**: Server-side AI processing with Mix platform
- **Type-safe API Routes**: Full-stack TypeScript with TanStack Start

## Prerequisites

- [Bun](https://bun.sh) or npm/pnpm/yarn
- [Mix Server](https://docs.mix.dev) running locally or remotely
- Anthropic API key configured in Mix Server

## Setup

1. **Install dependencies:**
   ```bash
   bun install
   ```

2. **Configure environment variables:**

   Copy `.env.example` to `.env`:
   ```bash
   cp .env.example .env
   ```

   Update `MIX_SERVER_URL` in `.env`:
   ```
   MIX_SERVER_URL=http://localhost:8088
   ```

3. **Start the development server:**
   ```bash
   bun run dev
   ```

The app will be available at `http://localhost:3001`

## How It Works

### 1. File Upload Flow

- User uploads a CSV file containing portfolio data
- File is validated client-side and displayed in a preview table
- On "Analyze Portfolio" click:
  - Creates a new Mix session
  - Uploads CSV to Mix storage
  - Navigates to analysis page

### 2. AI Analysis Flow

- Analysis page connects to Mix streaming API via Server-Sent Events (SSE)
- Sends analysis request with uploaded file URL
- Receives real-time updates:
  - **Thinking events**: AI reasoning process
  - **Content events**: Analysis text
  - **Tool events**: Visualizations (charts, graphs)
  - **Complete event**: Stream finished

### 3. Architecture

```
src/
├── components/
│   ├── FileUploader.tsx    # Drag-and-drop file upload
│   ├── DataTable.tsx        # CSV preview table
│   ├── StreamingChat.tsx    # Real-time AI responses
│   └── ChartDisplay.tsx     # Visualization renderer
├── routes/
│   ├── index.tsx            # Upload page
│   ├── analyze.$sessionId.tsx  # Analysis page
│   └── api/
│       ├── session.ts       # Create Mix session
│       ├── upload.ts        # Upload file to Mix
│       └── stream.$sessionId.ts  # SSE streaming endpoint
└── lib/
    ├── mix-client.ts        # Mix SDK client
    └── mix-streaming.ts     # Streaming utilities
```

## API Routes

### POST /api/session
Creates a new Mix session for portfolio analysis.

**Request:**
```json
{
  "title": "Portfolio Analysis - portfolio.csv"
}
```

**Response:**
```json
{
  "success": true,
  "session": { "id": "session-123", ... }
}
```

### POST /api/upload
Uploads a CSV file to Mix storage.

**Request:** FormData with `file` and `sessionId`

**Response:**
```json
{
  "success": true,
  "file": {
    "url": "https://...",
    "name": "portfolio.csv",
    "size": 12345,
    "type": "text/csv"
  }
}
```

### GET /api/stream/:sessionId
Server-Sent Events stream for real-time AI analysis.

**Query params:** `message` (analysis request)

**Events:**
- `thinking`: AI reasoning updates
- `content`: Analysis text chunks
- `tool`: Visualization data
- `error`: Error messages
- `complete`: Stream finished

## Building For Production

```bash
bun run build
```

## Testing

```bash
bun run test
```

## Code Quality

```bash
bun run lint      # Lint code
bun run format    # Format code
bun run check     # Check both
```

## Learn More

- [Mix SDK Documentation](https://docs.mix.dev)
- [TanStack Start](https://tanstack.com/start)
- [TanStack Router](https://tanstack.com/router)
- [Shadcn/ui](https://ui.shadcn.com)
